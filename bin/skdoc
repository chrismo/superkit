#!/usr/bin/env bash

set -euo pipefail

declare -r doc_dir=${XDG_DATA_HOME:-$HOME/.local/share}/superkit/doc

function _check_command() {
  command -v "$1" &>/dev/null
}

function _reader() {
  local -r doc_fn="$1"

  if _check_command bat; then
    bat --style=plain --color=always "$doc_fn"
  elif _check_command glow; then
    glow "$doc_fn"
  else
    local -r pager="${PAGER:-less}"

    $pager -FX "$doc_fn"
  fi
}

function default() {
  local -r glob_pattern="${1:-*}"

  # TODO: support docs for sk library of func/ops
  # TODO: support selecting docs if multiple match

  local -r doc_fn=$(
    find "$doc_dir" -name "*$glob_pattern*" -type f |
      sort |
      head -n 1
  )
  _reader "$doc_fn"
}

default "$@"
